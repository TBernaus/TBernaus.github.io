<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://apis.google.com/js/api.js"></script>
</head>

<body>
    <div class="container">
        <iframe src="https://calendar.google.com/calendar/embed?src=tomasviatges%40gmail.com&ctz=Europe%2FMadrid"
        width="800" height="600" frameborder="0" scrolling="no"
        sandbox="allow-same-origin allow-scripts"></iframe>
    
    </div>
    <div class="events-container">
        <h2>Pr√≥ximos Eventos</h2>
        <ul id="events-list"></ul>
    </div>

    <script>
        const CLIENT_ID = '539049653247-am6vdmgie5a1fmcga6afe8l387af8lnd.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyCdkXXhPTZ3Bo1XRuDspGRZtp4z3aZ8xTc';
        const CALENDAR_ID = 'tomasviatges@gmail.com';
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
        const SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES,
                cookiepolicy: 'single_host_origin',
            }).then(function () {
                listUpcomingEvents();
            });
        }

        function listUpcomingEvents() {
            gapi.client.calendar.events.list({
                'calendarId': CALENDAR_ID,
                'timeMin': (new Date()).toISOString(),
                'showDeleted': false,
                'singleEvents': true,
                'maxResults': 10,
                'orderBy': 'startTime'
            }).then(function (response) {
                var events = response.result.items;
                var eventsList = document.getElementById('events-list');

                if (events.length > 0) {
                    for (i = 0; i < events.length; i++) {
                        var event = events[i];
                        var when = event.start.dateTime;
                        if (!when) {
                            when = event.start.date;
                        }
                        var li = document.createElement("li");
                        li.appendChild(document.createTextNode(`${event.summary} (${when})`));
                        eventsList.appendChild(li);
                    }
                } else {
                    eventsList.appendChild(document.createTextNode('No upcoming events found.'));
                }
            });
        }

        handleClientLoad();
    </script>
</body>

</html>
